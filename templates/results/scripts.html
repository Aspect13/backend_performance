<script src="{{ url_for('design-system.static', filename='assets/js/dropdowns.js') }}"></script>
<script src="{{ url_for('design-system.static', filename='assets/vendor/nouislider/nouislider.js') }}"></script>
<script src="{{ url_for('design-system.static', filename='assets/vendor/nouislider/wNumb.min.js') }}"></script>
<script src="{{ url_for('backend_performance.static', filename='js/performanceBackend.js') }}"></script>
<script src="https://unpkg.com/bootstrap-table@1.15.5/dist/bootstrap-table.min.js"></script>
<script src="{{ url_for('backend_performance.static', filename='js/logs_updater.js') }}"></script>
<script src="{{ url_for('backend_performance.static', filename='js/in_progress.js') }}"></script>
<script src="{{ url_for('backend_performance.static', filename='js/artifacts.js') }}"></script>
<script>
    let low_value = 0;
    let high_value = 100;
    $(document).ready(function() {
        var timerId = setInterval(function(){
            updateChartAndErrorsTable(timerId);
        },60000);
        setParams();
        loadRequestData('/api/v1/backend_performance/charts/requests/summary', "Response time, ms");
        fillErrorTable();
        fillSummaryTable();
       // $('#RT').trigger( "click" )
        $("#analytics").hide();
        const perfomanceTimePicker = noUiSlider.create($("#vuh-perfomance-time-picker")[0], {
            range: {
                'min': 0,
                'max': 100
            },
            start: [low_value, high_value],
            connect: true,
            format: wNumb({
                decimals: 0
            }),
        })
        perfomanceTimePicker.on('set', function(values) {
            low_value = values[0]
            high_value = values[1]
            resizeChart();
        });
    });

    function updateChartAndErrorsTable(timerId) {
        if ($("#sampler").val() == null) {
            samplerType = "Request"
        } else {
            samplerType = $("#sampler").val().toUpperCase();
        }

        statusType = $("#status").val().toLowerCase();
        aggregator = $("#aggregator").val().toLowerCase();

        $.get(
        `/api/v1/backend_performance/report_status/${getSelectedProjectId()}/${testId}`,
        function(data) {
            var status = data["message"]
            if (!['finished', 'error', 'failed', 'success'].includes(status.toLowerCase())) {
                const sections = ['#RT', '#AR', '#HT', "#AN"];
                sections.forEach(element => {
                    if ($(element).hasClass("active")) {
                        $(element).trigger( "click" )
                    }
                });
                fillErrorTable();
            } else {
                clearInterval(timerId);
            }
        });

    }
</script>